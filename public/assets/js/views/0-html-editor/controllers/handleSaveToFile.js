import{editors,title,chooseLanguageHtml}from"./defaultVars.js";import storage from"../../../modules/storage.js";import createModalWindow from"../../../modules/createModalWindow.js";import exportToHTML from"../../../modules/exportToHTML.js";import generateRandomId from"../../../modules/generateRandomId.js";import formatCode from"../../../modules/formatCode.js";let baseUrl="https://agasallo-1-e1977709.deta.app";const MarkdownToHtml=async e=>await formatCode(baseUrl+"/api/convert/to/md",{html_code:e});export default function handleSaveToFile(){createModalWindow({id:"save-window",title:"Html output",modal:!0,width:"60%",height:"90%",x:"center",y:"center",html:'<div class="options">\n        <div class="option">\n          <button type="button" class="btn" id="copy">ğŸ’¾ Copy code</button>\n          <button type="button" class="btn" id="export">ğŸ—’ï¸ Export html</button>\n        </div>\n        <div class="option">\n            <textarea id="htmlOutput" name="htmlOutput">Working...</textarea>\n        </div>\n    </div>',oncreate:()=>oncreateFn()})}async function oncreateFn(){let e=document.querySelector("#htmlOutput");const t=CodeMirror.fromTextArea(e,{lineNumbers:!0,lineWrapping:!0,lineLength:80,mode:"htmlmixed",theme:"dracula",gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0});let o="",n="",r="";const a=storage("editor_links");if(a){const{meta:e,css:t,js:s}=a;o=t.map((e=>`<link rel="stylesheet" href="${e}"/>`)),n=s.map((e=>`<script rel="javascript" src="${e}"><\/script>`)),r=e}let s=html_beautify(editors[0].getValue());"md"===chooseLanguageHtml.value&&(s=await MarkdownToHtml(editors[0].getValue()),console.log("get this"));const l=generateHtmlTemplate({id:generateRandomId(),title:title.value,meta:r,linksHref:o,cssCompressed:editors[1].getValue(),content:s,scriptsSrc:n,jsCompressed:editors[2].getValue()}),i=document.querySelector("#copy"),d=document.querySelector("#export");i.addEventListener("click",(e=>{e.target.textContent="âœ… Copied!",navigator.clipboard.writeText(t.getValue());let o=setTimeout((()=>{e.target.textContent="ğŸ’¾ Copy code",clearTimeout(o)}),800)}),!1),d.addEventListener("click",(e=>{exportToHTML(`${title.value}.html`,l)}),!1),t.setValue(l)}function generateHtmlTemplate(e){return`<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8">\n  <meta name="viewport" content="width=device-width, initial-scale=1.0">\n  <title>${e.title}</title>\n  ${e.meta}\n\n  \x3c!-- Links --\x3e\n  ${e.linksHref}\n\n  \x3c!-- Custom css --\x3e\n  <style rel="stylesheet">\n${e.cssCompressed}\n  </style>\n</head>\n<body>\n  ${e.content}\n\n  \x3c!-- Scripts --\x3e\n  ${e.scriptsSrc}\n\n  \x3c!-- Custom js --\x3e\n  <script rel="javascript" type="module">\n${e.jsCompressed}\n  <\/script>\n</body>\n</html>`}